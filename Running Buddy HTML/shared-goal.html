<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shared Goal - Running Buddy</title>
    <meta name="description" content="Track your shared running goals and challenges with your running buddy">
    
    <!-- PWA -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Running Buddy">
    <link rel="manifest" href="pwa_files/manifest.json">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    
    <!-- global styles -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/shared-goal.css">
    
    <!-- icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
</head>
<body>
    <div class="app-container">
        <!-- header -->
        <header class="header">
            <div class="header-content">
                <button class="back-btn" style="display:none" aria-hidden="true" tabindex="-1">
                    <i data-lucide="arrow-left" class="icon"></i>
                </button>
                <div class="header-info">
                    <h1 class="header-title">Shared Goal</h1>
                    <p class="header-subtitle">Track your progress together</p>
                </div>
                <div class="header-icon">
                    <button class="profile-btn" onclick="window.location.href='profile.html'" title="Profile">
                        <i data-lucide="user" class="icon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- main content -->
        <main class="main-content">
            <!-- shared goal banner -->
            <div class="shared-goal-banner">
                <h2>Your Shared Goal</h2>
            </div>

            <!-- today's activity -->
            <div class="activity-card">
                <h3>Today's Activity</h3>
                <div class="activity-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="calories-burned">1800</span>
                        <span class="stat-unit">kcal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="distance-covered">3508</span>
                        <span class="stat-unit">m</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="steps-count">8500</span>
                        <span class="stat-unit">steps</span>
                    </div>
                </div>
            </div>

            <!-- common goal progress -->
            <div class="goal-progress-card">
                <div class="goal-header">
                    <h3>Set your common goal</h3>
                    <div class="goal-type-selector">
                        <select id="goal-type-select" class="goal-type-dropdown">
                            <option value="calories">Calories</option>
                            <option value="steps">Steps</option>
                            <option value="distance">Distance</option>
                            <option value="duration">Duration</option>
                        </select>
                    </div>
                </div>
                
                <!-- Inline Goal Setting -->
                <div class="inline-goal-setting">
                    <div class="goal-slider-container">
                        <input type="range" id="inline-goal-slider" class="goal-slider" min="1000" max="10000" step="50" value="2250">
                        <div class="slider-track">
                            <div class="slider-fill" id="slider-fill"></div>
                        </div>
                        <div class="slider-labels">
                            <span class="slider-min" id="slider-min">1000</span>
                            <span class="slider-max" id="slider-max">10000</span>
                        </div>
                    </div>
                    
                    <div class="goal-display">
                        <div class="current-goal">
                            <span class="goal-value" id="current-goal-value">2250</span>
                            <span class="goal-unit" id="current-goal-unit">kcal</span>
                        </div>
                        <div class="goal-progress">
                            <span class="progress-text">Current Progress: </span>
                            <span class="progress-percentage" id="current-progress">80%</span>
                        </div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 80%"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-percentage" id="progress-percentage">80%</span>
                        <span class="progress-target">to your goal</span>
                    </div>
                    <div class="goal-target">
                        <span id="goal-target">2250</span> kcal
                    </div>
                </div>
                <p class="next-goal">Next Goal</p>
            </div>

            <!-- challenge section -->
            <div class="challenge-card">
                <h3>Challenge</h3>
                <div class="challenge-content">
                    <div class="challenge-text">
                        <p class="challenge-description">Run 10 km together this weekend</p>
                        <p class="challenge-reward">Earn a badge for completing this challenge</p>
                    </div>
                    <div class="challenge-actions">
                        <button class="challenge-btn" disabled style="opacity:.6; cursor:not-allowed;">
                            <i data-lucide="clock" class="icon"></i>
                            Coming Soon
                        </button>
                        <div class="challenge-icon">
                            <i data-lucide="trophy" class="icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- running buddy info -->
            <div class="buddy-info-card">
                <h3>Your Running Buddy</h3>
                <div class="buddy-profile">
                    <div class="buddy-avatar">
                        <img src="assets/sarah.png" alt="Running Buddy" class="avatar-img" id="buddy-avatar">
                    </div>
                    <div class="buddy-details">
                        <h4 class="buddy-name" id="buddy-name">Sarah Chen</h4>
                        <div class="buddy-stats">
                            <div class="buddy-stat">
                                <i data-lucide="target" class="icon"></i>
                                <span id="buddy-pace">5:30 min/km</span>
                            </div>
                            <div class="buddy-stat">
                                <i data-lucide="play" class="icon"></i>
                                <span id="buddy-frequency">4 runs/week</span>
                            </div>
                        </div>
                        <div class="buddy-status">
                            <span class="status-badge confirmed">Confirmed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- action buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="endRun()">
                    <i data-lucide="stop" class="icon"></i>
                    End Run
                </button>
                <button class="btn btn-outline" onclick="goToMap()">
                    <i data-lucide="map" class="icon"></i>
                    Go to Map
                </button>
            </div>
        </main>

        <!-- Floating vitals control (inside app container) -->
        <div class="map-controls" aria-hidden="false">
            <button class="control-btn" id="open-vitals" aria-haspopup="dialog" aria-controls="vitalsDialog" title="Vitals">
                <i data-lucide="gauge" class="icon"></i>
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/app.js"></script>
    <script src="js/shared-goal.js"></script>
    
    <!-- Vitals modal logic (same behavior as index page) -->
    <script>
    (function () {
      const btnId = 'open-vitals';
      const overlayId = 'vitalsOverlay';
      const dialogId = 'vitalsDialog';

      if (window.lucide && window.lucide.createIcons) window.lucide.createIcons();

      function ensureModal() {
        if (document.getElementById(overlayId)) return;

        const overlay = document.createElement('div');
        overlay.id = overlayId;
        overlay.setAttribute('role', 'presentation');
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.42);display:none;align-items:center;justify-content:center;z-index:10000;';

        const dialog = document.createElement('div');
        dialog.id = dialogId;
        dialog.setAttribute('role', 'dialog');
        dialog.setAttribute('aria-modal', 'true');
        dialog.setAttribute('aria-label', 'Vitals');
        dialog.style.cssText = 'background:#fff;border-radius:12px;padding:16px 18px;width:360px;max-width:92vw;box-shadow:0 12px 40px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;';

        dialog.innerHTML = `
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="display:flex;align-items:center;gap:8px;font-weight:600;">
              <i data-lucide="activity"></i><span>Vitals</span>
            </div>
            <button id="vitalsClose" aria-label="Close" title="Close" style="border:none;background:transparent;cursor:pointer;padding:6px;border-radius:8px;">
              <i data-lucide="x"></i>
            </button>
          </div>
          <table style="width:100%;border-collapse:collapse;margin-top:6px;font-size:14px;color:#222;">
            <tr style="color:#666;font-size:12px;"><th style="text-align:left;padding-bottom:6px;">Metric</th><th style="text-align:left;padding-bottom:6px;">Value</th><th style="text-align:left;padding-bottom:6px;">Unit</th></tr>
            <tr><td style="padding:4px 0;">Heart Rate</td><td id="hr-value"   style="font-weight:700;">--</td><td>bpm</td></tr>
            <tr><td style="padding:4px 0;">SpO₂</td>      <td id="spo2-value" style="font-weight:700;">--</td><td>%</td></tr>
            <tr><td style="padding:4px 0;">Temperature</td><td id="temp-value" style="font-weight:700;">--</td><td>°C</td></tr>
          </table>
        `;

        overlay.appendChild(dialog);
        document.body.appendChild(overlay);

        if (window.lucide && window.lucide.createIcons) window.lucide.createIcons();

        function closeModal() {
          overlay.style.display = 'none';
          document.getElementById(btnId)?.focus();
          document.removeEventListener('keydown', onEsc);
        }
        function onEsc(e){ if (e.key === 'Escape') closeModal(); }

        document.getElementById('vitalsClose')?.addEventListener('click', closeModal);
        overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });

        window.closeVitalsModal = closeModal;
      }

      function openModal() {
        ensureModal();
        const overlay = document.getElementById(overlayId);
        overlay.style.display = 'flex';
        function onEsc(e){ if (e.key === 'Escape') window.closeVitalsModal?.(); }
        document.addEventListener('keydown', onEsc);
      }

      document.getElementById(btnId)?.addEventListener('click', openModal);

      window.updateVitals = function ({ hr, spo2, temp } = {}) {
        const hrEl = document.getElementById('hr-value');
        const sEl  = document.getElementById('spo2-value');
        const tEl  = document.getElementById('temp-value');
        if (hrEl && typeof hr   !== 'undefined') hrEl.textContent = hr;
        if (sEl  && typeof spo2 !== 'undefined') sEl.textContent  = spo2;
        if (tEl  && typeof temp !== 'undefined') tEl.textContent  = temp;
      };
    })();
    </script>
</body>
</html>
